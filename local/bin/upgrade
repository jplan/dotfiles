#!/usr/bin/sudo /bin/sh

FETCH=1

for arg in $@; do
	case $arg in
		--nofetch) FETCH=0;;
		--write) EFLAGS=--autounmask-write;;
	esac
done

if [ $FETCH -eq 1 ]; then
	emerge --sync || exit
	layman -S || exit
fi

emerge $EFLAGS -auvND world || exit
read -p "Read any portage messages then tap [enter]..."
etc-update || exit
revdep-rebuild || exit
haskell-updater || exit
emacs-updater || exit
python-updater || exit
